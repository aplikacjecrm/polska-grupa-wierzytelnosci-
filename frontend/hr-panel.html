<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HR Panel - ZarzÄ…dzanie wnioskami</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      padding: 30px;
    }
    
    h1 {
      color: #1a1a1a;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #e0e0e0;
    }
    
    .tab-btn {
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      color: #666;
      transition: all 0.3s;
    }
    
    .tab-btn:hover {
      color: #667eea;
    }
    
    .tab-btn.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      padding: 20px;
      border-radius: 12px;
      color: white;
      text-align: center;
    }
    
    .stat-card.pending { background: linear-gradient(135deg, #FFA726, #FB8C00); }
    .stat-card.approved { background: linear-gradient(135deg, #66BB6A, #43A047); }
    .stat-card.rejected { background: linear-gradient(135deg, #EF5350, #E53935); }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 10px 0;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    .request-card {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s;
    }
    
    .request-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }
    
    .request-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }
    
    .request-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 5px;
    }
    
    .request-employee {
      color: #666;
      font-size: 0.9rem;
    }
    
    .request-badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .badge-vacation { background: #E3F2FD; color: #1976D2; }
    .badge-training { background: #E8F5E9; color: #388E3C; }
    .badge-document { background: #FFF3E0; color: #F57C00; }
    
    .request-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 15px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    
    .detail-item {
      font-size: 0.9rem;
    }
    
    .detail-label {
      color: #666;
      margin-bottom: 3px;
    }
    
    .detail-value {
      font-weight: 600;
      color: #1a1a1a;
    }
    
    .request-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s;
    }
    
    .btn-approve {
      background: #66BB6A;
      color: white;
    }
    
    .btn-approve:hover {
      background: #43A047;
    }
    
    .btn-reject {
      background: #EF5350;
      color: white;
    }
    
    .btn-reject:hover {
      background: #E53935;
    }
    
    .btn-view {
      background: #42A5F5;
      color: white;
    }
    
    .btn-view:hover {
      background: #1E88E5;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    
    .empty-state svg {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
      opacity: 0.3;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 1.1rem;
    }
    
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      padding: 8px 16px;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      transition: all 0.3s;
    }
    
    .back-link:hover {
      background: rgba(255,255,255,0.3);
    }
  </style>
</head>
<body>
  <a href="/index.html" class="back-link">â† PowrÃ³t do gÅ‚Ã³wnego panelu</a>
  
  <div class="container">
    <h1>
      <span>ğŸ‘¥</span>
      Panel HR
    </h1>
    <p class="subtitle">ZarzÄ…dzanie wnioskami pracownikÃ³w</p>
    
    <!-- Statystyki -->
    <div class="stats-grid" id="statsGrid">
      <div class="stat-card pending">
        <div class="stat-label">â³ OczekujÄ…ce</div>
        <div class="stat-value" id="pendingCount">-</div>
      </div>
      <div class="stat-card approved">
        <div class="stat-label">âœ… Zatwierdzone</div>
        <div class="stat-value" id="approvedCount">-</div>
      </div>
      <div class="stat-card rejected">
        <div class="stat-label">âŒ Odrzucone</div>
        <div class="stat-value" id="rejectedCount">-</div>
      </div>
    </div>
    
    <!-- ZakÅ‚adki -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="vacations" onclick="switchTab('vacations')">
        ğŸ–ï¸ Wnioski urlopowe
      </button>
      <button class="tab-btn" data-tab="trainings" onclick="switchTab('trainings')">
        ğŸ“ Wnioski o szkolenia
      </button>
      <button class="tab-btn" data-tab="documents" onclick="switchTab('documents')">
        ğŸ“„ Dokumenty do weryfikacji
      </button>
      <button class="tab-btn" data-tab="tickets" onclick="switchTab('tickets')">
        ğŸ« Wszystkie tickety HR
      </button>
    </div>
    
    <!-- ZawartoÅ›Ä‡ zakÅ‚adek -->
    <div id="tab-vacations" class="tab-content active">
      <div class="loading">Åadowanie wnioskÃ³w urlopowych...</div>
    </div>
    
    <div id="tab-trainings" class="tab-content">
      <div class="loading">Åadowanie wnioskÃ³w o szkolenia...</div>
    </div>
    
    <div id="tab-documents" class="tab-content">
      <div class="loading">Åadowanie dokumentÃ³w...</div>
    </div>
    
    <div id="tab-tickets" class="tab-content">
      <div class="loading">Åadowanie ticketÃ³w...</div>
    </div>
  </div>
  
  <script src="/scripts/api.js"></script>
  <script>
    // DEBUG: SprawdÅº czy API jest zaÅ‚adowane
    console.log('ğŸ” HR Panel - Sprawdzam API:', typeof window.api);
    
    // Fallback API jeÅ›li nie ma window.api
    if (!window.api) {
      console.log('âš ï¸ window.api nie istnieje, tworzÄ™ fallback');
      window.api = {
        request: async function(url, options = {}) {
          const token = localStorage.getItem('token');
          const headers = {
            'Content-Type': 'application/json',
            ...(token ? { 'Authorization': `Bearer ${token}` } : {})
          };
          
          const response = await fetch(`/api${url}`, {
            ...options,
            headers
          });
          
          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || 'API Error');
          }
          
          return response.json();
        }
      };
    }
    
    // PrzeÅ‚Ä…czanie zakÅ‚adek
    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
      document.getElementById(`tab-${tabName}`).classList.add('active');
      
      // ZaÅ‚aduj dane dla zakÅ‚adki
      if (tabName === 'vacations') loadVacations();
      else if (tabName === 'trainings') loadTrainings();
      else if (tabName === 'documents') loadDocuments();
      else if (tabName === 'tickets') loadAllTickets();
    }
    
    // ZaÅ‚aduj wnioski urlopowe
    async function loadVacations() {
      console.log('ğŸ” loadVacations() wywoÅ‚ane');
      const container = document.getElementById('tab-vacations');
      container.innerHTML = '<div class="loading">Åadowanie...</div>';
      
      try {
        console.log('ğŸ“¡ WysyÅ‚am request do /api/hr-vacations/pending');
        const res = await window.api.request('/hr-vacations/pending');
        console.log('âœ… OdpowiedÅº otrzymana:', res);
        const vacations = res.vacations || [];
        console.log(`ğŸ“‹ Liczba wnioskÃ³w: ${vacations.length}`);
        
        if (vacations.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div style="font-size: 3rem;">ğŸ–ï¸</div>
              <h3>Brak oczekujÄ…cych wnioskÃ³w urlopowych</h3>
              <p>Wszystko aktualne!</p>
            </div>
          `;
          return;
        }
        
        container.innerHTML = vacations.map(v => `
          <div class="request-card">
            <div class="request-header">
              <div>
                <div class="request-title">${v.employee_name || 'Pracownik'}</div>
                <div class="request-employee">${v.position || ''} â€¢ ${v.employee_email || ''}</div>
              </div>
              <span class="request-badge badge-vacation">ğŸ–ï¸ Urlop</span>
            </div>
            
            <div class="request-details">
              <div class="detail-item">
                <div class="detail-label">Typ urlopu</div>
                <div class="detail-value">${getVacationType(v.vacation_type)}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Od - Do</div>
                <div class="detail-value">${new Date(v.start_date).toLocaleDateString('pl-PL')} - ${new Date(v.end_date).toLocaleDateString('pl-PL')}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Liczba dni</div>
                <div class="detail-value">${v.days_count} dni</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Data wniosku</div>
                <div class="detail-value">${new Date(v.request_date).toLocaleDateString('pl-PL')}</div>
              </div>
            </div>
            
            ${v.notes ? `<div style="padding: 10px; background: #fff9e6; border-left: 3px solid #FFA726; border-radius: 4px; margin: 10px 0;"><strong>Uwagi:</strong> ${v.notes}</div>` : ''}
            
            <div class="request-actions">
              <button class="btn btn-approve" onclick="approveVacation(${v.id})">
                âœ“ ZatwierdÅº
              </button>
              <button class="btn btn-reject" onclick="rejectVacation(${v.id})">
                âœ— OdrzuÄ‡
              </button>
              ${v.ticket_id ? `<button class="btn btn-view" onclick="viewTicket(${v.ticket_id})">ğŸ« Zobacz ticket</button>` : ''}
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('âŒ BÅ‚Ä…d Å‚adowania wnioskÃ³w:', error);
        container.innerHTML = `
          <div class="empty-state">
            <h3>âŒ BÅ‚Ä…d Å‚adowania wnioskÃ³w</h3>
            <p>${error.message}</p>
            <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
              SprawdÅº konsolÄ™ przeglÄ…darki (F12) dla szczegÃ³Å‚Ã³w
            </p>
            <button onclick="loadVacations()" 
                    style="padding: 10px 20px; background: #3B82F6; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px;">
              ğŸ”„ SprÃ³buj ponownie
            </button>
          </div>
        `;
      }
    }
    
    // ZatwierdÅº urlop - z modalem na notatkÄ™
    function approveVacation(vacationId) {
      showApprovalModal('vacation', vacationId, 'ZatwierdÅº wniosek urlopowy', 'Notatka dla pracownika (opcjonalna):', async (notes) => {
        try {
          const res = await window.api.request(`/hr-vacations/${vacationId}/approve`, { 
            method: 'POST',
            body: JSON.stringify({ approval_notes: notes })
          });
          if (res.success) {
            alert('âœ… Wniosek zatwierdzony!');
            loadVacations();
            updateStats();
          }
        } catch (error) {
          alert('âŒ BÅ‚Ä…d: ' + error.message);
        }
      });
    }
    
    // OdrzuÄ‡ urlop - z modalem na powÃ³d
    function rejectVacation(vacationId) {
      showApprovalModal('vacation', vacationId, 'OdrzuÄ‡ wniosek urlopowy', 'PowÃ³d odrzucenia (wymagany):', async (reason) => {
        if (!reason) {
          alert('Musisz podaÄ‡ powÃ³d odrzucenia!');
          return;
        }
        try {
          const res = await window.api.request(`/hr-vacations/${vacationId}/reject`, {
            method: 'POST',
            body: JSON.stringify({ rejection_reason: reason })
          });
          if (res.success) {
            alert('âœ… Wniosek odrzucony');
            loadVacations();
            updateStats();
          }
        } catch (error) {
          alert('âŒ BÅ‚Ä…d: ' + error.message);
        }
      }, true);
    }
    
    // PokaÅ¼ ticket
    function viewTicket(ticketId) {
      alert(`Ticket ID: ${ticketId}\nTODO: OtworzyÄ‡ szczegÃ³Å‚y ticketu`);
    }
    
    // Helper functions
    function getVacationType(type) {
      const types = {
        'annual': 'ğŸ–ï¸ Wypoczynkowy',
        'sick': 'ğŸ¥ Zwolnienie',
        'unpaid': 'ğŸ’” BezpÅ‚atny',
        'parental': 'ğŸ‘¶ Rodzicielski',
        'occasional': 'âš¡ Na Å¼Ä…danie',
        'other': 'ğŸ“ Inny'
      };
      return types[type] || type;
    }
    
    // ZaÅ‚aduj statystyki
    async function updateStats() {
      try {
        console.log('ğŸ“Š ÅadujÄ™ statystyki...');
        const res = await window.api.request('/hr-vacations/pending');
        const pendingCount = res.vacations?.length || 0;
        console.log(`ğŸ“Š Pending: ${pendingCount}`);
        document.getElementById('pendingCount').textContent = pendingCount;
        
        // TODO: DodaÄ‡ statystyki zatwierdzonych i odrzuconych
        document.getElementById('approvedCount').textContent = '0';
        document.getElementById('rejectedCount').textContent = '0';
      } catch (error) {
        console.error('âŒ BÅ‚Ä…d Å‚adowania statystyk:', error);
        document.getElementById('pendingCount').textContent = '?';
        document.getElementById('approvedCount').textContent = '?';
        document.getElementById('rejectedCount').textContent = '?';
      }
    }
    
    // ZaÅ‚aduj wnioski o szkolenia
    async function loadTrainings() {
      const container = document.getElementById('tab-trainings');
      container.innerHTML = '<div class="loading">Åadowanie wnioskÃ³w o szkolenia...</div>';
      
      try {
        // Pobierz szkolenia ze statusem 'planned' (oczekujÄ…ce na zatwierdzenie)
        const res = await window.api.request('/hr-training/pending');
        const trainings = res.trainings || [];
        
        if (trainings.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div style="font-size: 3rem;">ğŸ“</div>
              <h3>Brak oczekujÄ…cych wnioskÃ³w o szkolenia</h3>
              <p>Wszystko aktualne!</p>
            </div>
          `;
          return;
        }
        
        container.innerHTML = trainings.map(t => `
          <div class="request-card">
            <div class="request-header">
              <div>
                <div class="request-title">${t.employee_name || 'Pracownik'}</div>
                <div class="request-employee">${t.title}</div>
              </div>
              <span class="request-badge badge-training">ğŸ“ Szkolenie</span>
            </div>
            
            <div class="request-details">
              <div class="detail-item">
                <div class="detail-label">Typ szkolenia</div>
                <div class="detail-value">${getTrainingType(t.training_type)}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Dostawca</div>
                <div class="detail-value">${t.provider || '-'}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Koszt</div>
                <div class="detail-value">${t.cost ? t.cost + ' PLN' : '-'}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Data rozpoczÄ™cia</div>
                <div class="detail-value">${t.start_date ? new Date(t.start_date).toLocaleDateString('pl-PL') : '-'}</div>
              </div>
            </div>
            
            ${t.description ? `<div style="padding: 10px; background: #e8f5e9; border-left: 3px solid #66BB6A; border-radius: 4px; margin: 10px 0;"><strong>Opis:</strong> ${t.description}</div>` : ''}
            
            <div class="request-actions">
              <button class="btn btn-approve" onclick="approveTraining(${t.id})">
                âœ“ ZatwierdÅº
              </button>
              <button class="btn btn-reject" onclick="rejectTraining(${t.id})">
                âœ— OdrzuÄ‡
              </button>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('âŒ BÅ‚Ä…d Å‚adowania szkoleÅ„:', error);
        container.innerHTML = `
          <div class="empty-state">
            <h3>âŒ BÅ‚Ä…d Å‚adowania wnioskÃ³w o szkolenia</h3>
            <p>${error.message}</p>
            <button onclick="loadTrainings()" style="padding: 10px 20px; background: #3B82F6; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px;">
              ğŸ”„ SprÃ³buj ponownie
            </button>
          </div>
        `;
      }
    }
    
    // ZatwierdÅº szkolenie - z modalem na notatkÄ™
    function approveTraining(trainingId) {
      showApprovalModal('training', trainingId, 'ZatwierdÅº szkolenie', 'Notatka dla pracownika (opcjonalna):', async (notes) => {
        try {
          const res = await window.api.request(`/hr-training/${trainingId}/approve`, { 
            method: 'POST',
            body: JSON.stringify({ approval_notes: notes })
          });
          if (res.success) {
            alert('âœ… Szkolenie zatwierdzone!');
            loadTrainings();
          }
        } catch (error) {
          alert('âŒ BÅ‚Ä…d: ' + error.message);
        }
      });
    }
    
    // OdrzuÄ‡ szkolenie - z modalem na powÃ³d
    function rejectTraining(trainingId) {
      showApprovalModal('training', trainingId, 'OdrzuÄ‡ szkolenie', 'PowÃ³d odrzucenia (wymagany):', async (reason) => {
        if (!reason) {
          alert('Musisz podaÄ‡ powÃ³d odrzucenia!');
          return;
        }
        try {
          const res = await window.api.request(`/hr-training/${trainingId}/reject`, {
            method: 'POST',
            body: JSON.stringify({ rejection_reason: reason })
          });
          if (res.success) {
            alert('âœ… Szkolenie odrzucone');
            loadTrainings();
          }
        } catch (error) {
          alert('âŒ BÅ‚Ä…d: ' + error.message);
        }
      }, true);
    }
    
    // Uniwersalny modal do zatwierdzania/odrzucania
    function showApprovalModal(type, id, title, label, onSubmit, required = false) {
      const existingModal = document.getElementById('approvalModal');
      if (existingModal) existingModal.remove();
      
      const modalHTML = `
        <div id="approvalModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;" onclick="if(event.target === this) this.remove()">
          <div style="background: white; border-radius: 12px; padding: 30px; max-width: 500px; width: 90%;" onclick="event.stopPropagation()">
            <h3 style="margin: 0 0 20px 0;">${title}</h3>
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">${label}</label>
              <textarea id="approvalNotes" rows="4" ${required ? 'required' : ''} 
                        style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;"
                        placeholder="${required ? 'Podaj powÃ³d...' : 'Opcjonalna notatka...'}"></textarea>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
              <button onclick="document.getElementById('approvalModal').remove()" 
                      style="padding: 10px 20px; background: #999; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Anuluj
              </button>
              <button id="approvalSubmitBtn" 
                      style="padding: 10px 20px; background: ${required ? '#EF5350' : '#66BB6A'}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                ${required ? 'âœ— OdrzuÄ‡' : 'âœ“ ZatwierdÅº'}
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      document.getElementById('approvalSubmitBtn').onclick = () => {
        const notes = document.getElementById('approvalNotes').value.trim();
        document.getElementById('approvalModal').remove();
        onSubmit(notes);
      };
      
      document.getElementById('approvalNotes').focus();
    }
    
    // Helper: typ szkolenia
    function getTrainingType(type) {
      const types = {
        'course': 'ğŸ“š Kurs',
        'certification': 'ğŸ“œ Certyfikacja',
        'conference': 'ğŸ¤ Konferencja',
        'workshop': 'ğŸ› ï¸ Warsztat',
        'webinar': 'ğŸ’» Webinar',
        'other': 'ğŸ“ Inne'
      };
      return types[type] || type;
    }
    
    // ZaÅ‚aduj dokumenty do weryfikacji
    async function loadDocuments() {
      const container = document.getElementById('tab-documents');
      container.innerHTML = '<div class="loading">Åadowanie dokumentÃ³w...</div>';
      
      try {
        const res = await window.api.request('/hr-documents/pending');
        const documents = res.documents || [];
        
        if (documents.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div style="font-size: 3rem;">ğŸ“„</div>
              <h3>Brak dokumentÃ³w do weryfikacji</h3>
              <p>Wszystko aktualne!</p>
            </div>
          `;
          return;
        }
        
        container.innerHTML = documents.map(d => `
          <div class="request-card">
            <div class="request-header">
              <div>
                <div class="request-title">${d.employee_name || 'Pracownik'}</div>
                <div class="request-employee">${d.title}</div>
              </div>
              <span class="request-badge badge-document">ğŸ“„ Dokument</span>
            </div>
            
            <div class="request-details">
              <div class="detail-item">
                <div class="detail-label">Typ dokumentu</div>
                <div class="detail-value">${getDocumentType(d.document_type)}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Data wystawienia</div>
                <div class="detail-value">${d.issue_date ? new Date(d.issue_date).toLocaleDateString('pl-PL') : '-'}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">WaÅ¼ny do</div>
                <div class="detail-value">${d.expiry_date ? new Date(d.expiry_date).toLocaleDateString('pl-PL') : '-'}</div>
              </div>
            </div>
            
            <div class="request-actions">
              <a href="/api/hr-documents/${d.id}/download" target="_blank" class="btn btn-view">ğŸ“¥ Pobierz</a>
              <button class="btn btn-approve" onclick="verifyDocument(${d.id})">âœ“ Zweryfikuj</button>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('âŒ BÅ‚Ä…d Å‚adowania dokumentÃ³w:', error);
        container.innerHTML = `
          <div class="empty-state">
            <h3>âŒ BÅ‚Ä…d Å‚adowania dokumentÃ³w</h3>
            <p>${error.message}</p>
            <button onclick="loadDocuments()" style="padding: 10px 20px; background: #3B82F6; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px;">
              ğŸ”„ SprÃ³buj ponownie
            </button>
          </div>
        `;
      }
    }
    
    // Zweryfikuj dokument
    async function verifyDocument(docId) {
      if (!confirm('Czy potwierdzasz weryfikacjÄ™ tego dokumentu?')) return;
      
      try {
        const res = await window.api.request(`/hr-documents/${docId}/verify`, { method: 'POST' });
        if (res.success) {
          alert('âœ… Dokument zweryfikowany!');
          loadDocuments();
        }
      } catch (error) {
        alert('âŒ BÅ‚Ä…d: ' + error.message);
      }
    }
    
    // Helper: typ dokumentu
    function getDocumentType(type) {
      const types = {
        'contract': 'ğŸ“ Umowa',
        'annex': 'ğŸ“‘ Aneks',
        'certificate': 'ğŸ“ Certyfikat',
        'diploma': 'ğŸ“ Dyplom',
        'id_card': 'ğŸªª DowÃ³d',
        'medical_exam': 'ğŸ¥ Badania',
        'safety_training': 'âš ï¸ BHP',
        'nda': 'ğŸ”’ NDA',
        'other': 'ğŸ“„ Inne'
      };
      return types[type] || type;
    }
    
    // ZaÅ‚aduj wszystkie tickety HR
    async function loadAllTickets() {
      const container = document.getElementById('tab-tickets');
      container.innerHTML = '<div class="loading">Åadowanie ticketÃ³w HR...</div>';
      
      try {
        const res = await window.api.request('/tickets?department=HR');
        const tickets = res.tickets || [];
        
        if (tickets.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div style="font-size: 3rem;">ğŸ«</div>
              <h3>Brak ticketÃ³w HR</h3>
              <p>Brak zgÅ‚oszeÅ„ do obsÅ‚ugi</p>
            </div>
          `;
          return;
        }
        
        container.innerHTML = tickets.map(t => `
          <div class="request-card">
            <div class="request-header">
              <div>
                <div class="request-title">${t.title}</div>
                <div class="request-employee">${t.user_name || ''} â€¢ ${t.ticket_number}</div>
              </div>
              <span class="request-badge" style="background: ${getTicketStatusColor(t.status)}; color: white;">
                ${t.status}
              </span>
            </div>
            
            <div class="request-details">
              <div class="detail-item">
                <div class="detail-label">Typ</div>
                <div class="detail-value">${t.ticket_type || '-'}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Priorytet</div>
                <div class="detail-value">${t.priority || 'normal'}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Data utworzenia</div>
                <div class="detail-value">${new Date(t.created_at).toLocaleDateString('pl-PL')}</div>
              </div>
            </div>
            
            ${t.details ? `<div style="padding: 10px; background: #f5f5f5; border-radius: 4px; margin: 10px 0; font-size: 0.9rem;">${t.details}</div>` : ''}
          </div>
        `).join('');
        
      } catch (error) {
        console.error('âŒ BÅ‚Ä…d Å‚adowania ticketÃ³w:', error);
        container.innerHTML = `
          <div class="empty-state">
            <h3>âŒ BÅ‚Ä…d Å‚adowania ticketÃ³w</h3>
            <p>${error.message}</p>
            <button onclick="loadAllTickets()" style="padding: 10px 20px; background: #3B82F6; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px;">
              ğŸ”„ SprÃ³buj ponownie
            </button>
          </div>
        `;
      }
    }
    
    // Helper: kolor statusu ticketu
    function getTicketStatusColor(status) {
      const colors = {
        'Nowy': '#FFA726',
        'W trakcie': '#42A5F5',
        'RozwiÄ…zany': '#66BB6A',
        'ZamkniÄ™ty': '#78909C',
        'open': '#FFA726',
        'in_progress': '#42A5F5',
        'resolved': '#66BB6A',
        'closed': '#78909C'
      };
      return colors[status] || '#999';
    }
    
    // Inicjalizacja
    window.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸš€ HR Panel - DOMContentLoaded - inicjalizacja...');
      console.log('ğŸ”‘ Token z localStorage:', localStorage.getItem('token') ? 'EXISTS' : 'BRAK');
      
      // SprawdÅº czy uÅ¼ytkownik jest zalogowany
      const token = localStorage.getItem('token');
      if (!token) {
        console.warn('âš ï¸ Brak tokenu - uÅ¼ytkownik niezalogowany!');
        document.getElementById('tab-vacations').innerHTML = `
          <div class="empty-state">
            <h3>âŒ Nie jesteÅ› zalogowany</h3>
            <p>Musisz siÄ™ zalogowaÄ‡ jako HR lub Admin</p>
            <a href="/index.html" style="padding: 10px 20px; background: #3B82F6; color: white; text-decoration: none; border-radius: 8px; display: inline-block; margin-top: 20px;">
              PrzejdÅº do logowania
            </a>
          </div>
        `;
        return;
      }
      
      console.log('âœ… Token istnieje, Å‚adujÄ™ dane...');
      loadVacations();
      updateStats();
    });
  </script>
</body>
</html>
